<div class="create-dish-container">
  <mat-card class="form-card">
    <mat-card-header>
      <h2>Neues Dish erstellen</h2>
    </mat-card-header>

    <mat-card-content>
      <form [formGroup]="form">
        <!-- Dish Name -->
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Dish Name</mat-label>
          <input
            matInput
            formControlName="name"
            placeholder="z.B. Carbonara Pasta"
          />
          <mat-error *ngIf="form.get('name')?.hasError('required')">
            Name ist erforderlich
          </mat-error>
          <mat-error *ngIf="form.get('name')?.hasError('minlength')">
            Name muss mindestens 3 Zeichen lang sein
          </mat-error>
        </mat-form-field>

        <!-- Description -->
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Beschreibung</mat-label>
          <textarea
            matInput
            formControlName="description"
            rows="4"
            placeholder="Beschreiben Sie das Dish..."
          ></textarea>
          <mat-error *ngIf="form.get('description')?.hasError('required')">
            Beschreibung ist erforderlich
          </mat-error>
          <mat-error *ngIf="form.get('description')?.hasError('minlength')">
            Beschreibung muss mindestens 10 Zeichen lang sein
          </mat-error>
        </mat-form-field>

        <!-- Price -->
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Preis (€)</mat-label>
          <input
            matInput
            type="number"
            step="0.01"
            formControlName="price"
            placeholder="z.B. 12.99"
          />
          <mat-error *ngIf="form.get('price')?.hasError('required')">
            Preis ist erforderlich
          </mat-error>
          <mat-error *ngIf="form.get('price')?.hasError('min')">
            Preis muss größer als 0 sein
          </mat-error>
        </mat-form-field>

        <!-- Category Selection -->
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Kategorie</mat-label>
          <mat-select formControlName="category_id">
            <mat-option *ngIf="isCategoriesLoading" disabled>
              Kategorien werden geladen...
            </mat-option>
            <mat-option *ngFor="let cat of categories" [value]="cat.category_id">
              {{ cat.category_name }}
            </mat-option>
          </mat-select>
          <mat-error *ngIf="form.get('category_id')?.hasError('required')">
            Kategorie ist erforderlich
          </mat-error>
        </mat-form-field>

        <!-- Available Toggle -->
        <div class="checkbox-group">
          <label>
            <input
              type="checkbox"
              formControlName="available"
            />
            Verfügbar
          </label>
        </div>

        <!-- Image Upload -->
        <div class="image-upload-section">
          <div class="image-preview" *ngIf="imagePreview">
            <img [src]="imagePreview" alt="Vorschau" />
          </div>
          <label for="image-input" class="upload-label">
            <mat-icon>cloud_upload</mat-icon>
            <span>{{ imagePreview ? 'Bild ändern' : 'Bild hochladen' }}</span>
          </label>
          <input
            #imageInput
            id="image-input"
            type="file"
            accept="image/*"
            (change)="onImageSelected($event)"
            hidden
          />
        </div>
      </form>
    </mat-card-content>

    <mat-card-actions>
      <button
        mat-raised-button
        color="primary"
        (click)="onSubmit()"
        [disabled]="!form.valid || isLoading"
      >
        <mat-icon *ngIf="!isLoading">save</mat-icon>
        <span *ngIf="!isLoading">Erstellen</span>
        <span *ngIf="isLoading">
          <mat-spinner diameter="20"></mat-spinner>
        </span>
      </button>
      <button mat-button (click)="onCancel()" [disabled]="isLoading">
        Abbrechen
      </button>
    </mat-card-actions>
  </mat-card>
</div>
