<h2>Incoming Orders</h2>

<ng-container *ngIf="orders$ | async as orders; else loading">

  <div *ngIf="orders.length === 0">
    <p>No orders yet.</p>
  </div>

  <mat-card *ngFor="let order of orders" style="margin-bottom:12px">
    <mat-card-title>Order #{{ order.order_id }}</mat-card-title>

    <p>Status: <strong>{{ order.status }}</strong></p>
    <p>Total: {{ order.total_price }} €</p>
    <p>Address: {{ order.delivery_address }}</p>

    <button mat-button (click)="toggleOrderDetails(order.order_id)">
      {{ expandedOrderId === order.order_id ? 'Hide Payload' : 'Show Payload' }}
    </button>

    <div *ngIf="order.status === 'PLACED'">
      <button
        mat-raised-button
        color="primary"
        (click)="updateOrderStatus(order, 'ACCEPTED')"
      >
        Accept
      </button>

      <button
        mat-raised-button
        color="warn"
        (click)="updateOrderStatus(order, 'DECLINED')"
      >
        Reject
      </button>
    </div>

    <div *ngIf="getNextStatus(order.status) as nextStatus">
      <button
        mat-raised-button
        color="accent"
        (click)="updateOrderStatus(order, nextStatus)"
      >
        Mark as {{ nextStatus }}
      </button>
    </div>

    <div *ngIf="expandedOrderId === order.order_id">
      <pre>{{ order.payload || order | json }}</pre>
    </div>
  </mat-card>

</ng-container>

<ng-template #loading>
  <p>Loading orders…</p>
</ng-template>
